namespace = misc

country_event = {
	id = misc.1
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		has_origin = origin_katzen
		has_tradition = tr_katzen_planetside_garrisons
	}
	immediate = {
		every_controlled_planet = {
			limit = {
				NOT = {
					has_planet_flag = playerflusion
					any_planet_army = {
						army_type = peacekeeper_army
					}
				}
				has_ground_combat = no
				is_colony = yes
			}
			while = { count = 1	create_army = { 
				name = "Katzenarmee Peacekeeper Garrison"	
				owner = event_target:katzenartig 
				species = owner_main_species 
				type = "peacekeeper_army"
				land_army = yes
			} }
		}
	}
}

country_event = {
	id = misc.3
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		has_origin = origin_katzen
	}
	immediate = {
		set_variable = { #count total systems, used so kaiser can change the name
			which = "player_katzen_galaxy_total_system_count"
			value = 0
		}
		every_system = { #every system in galaxy adds 1
			event_target:katzenartig = {
				change_variable = {
					which = "player_katzen_galaxy_total_system_count"
					value = 1
				}
			}
		}
		set_variable = { #count katzen systems, used so kaiser can change the name
			which = "player_katzen_total_system_count"
			value = 0
		}
		every_system_within_border = { #count katzen systems
			event_target:katzenartig = {
				change_variable = {
					which = "player_katzen_total_system_count"
					value = 1
				}
			}
		}
		set_variable = { #check for greater katzen imperium
			which = "player_greater_imperium_limit"
			value = "player_katzen_galaxy_total_system_count"
		}
		multiply_variable = { #the limit to form greater imperium is 45% the total systems
			which = "player_greater_imperium_limit"
			value = 0.45
		}
		set_variable = { #check for galactic katzen imperium
			which = "player_galactic_imperium_limit"
			value = "player_katzen_galaxy_total_system_count"
		}
		multiply_variable = { #the limit to form galactic imperium is 75% the total systems
			which = "player_galactic_imperium_limit"
			value = 0.75
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = player_big_katzen_empire_formed
				}
				check_variable = {
					which = "player_katzen_total_system_count"
					value >= "player_greater_imperium_limit"
				}
			}
			set_country_flag = player_big_katzen_empire_formed
			change_country_flag = {
				icon = {
					category="domination"
					file="domination_3.dds"
				}
				background = {
					category="backgrounds"
					file="v.dds"
				}
				colors = {
					"indigo"
					"dark_purple"
					"null"
					"null"
				}
			}
			set_name = "Großkatzenartig Imperium"
			every_country = { country_event = { id = misc.4 } }
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = player_galactic_katzen_empire_formed
				}
				check_variable = {
					which = "player_katzen_total_system_count"
					value >= "player_galactic_imperium_limit"
				}
			}
			set_country_flag = player_galactic_katzen_empire_formed
			change_country_flag = {
				icon = {
					category="domination"
					file="domination_18.dds"
				}
				background = {
					category="backgrounds"
					file="circle.dds"
				}
				colors = {
					"indigo"
					"dark_blue"
					"null"
					"null"
				}
			}
			set_name = "Galaktisches Katzimperium"
			every_country = { country_event = { id = misc.5 } }
		}
	}
}

country_event = { #big
	id = misc.4
	title = "misc.4.name"
	desc = "misc.4.desc"

	picture = GFX_evt_announcement
	show_sound = event_celebration
	location = from
	is_triggered_only = yes

	option = { #aw
		name = "misc.4.a"
		trigger = {
			NOT = {
				has_origin = origin_katzen
			}
		}
	}
	option = { #:KaiserPog:
		name = "misc.4.b"
		trigger = {
			has_origin = origin_katzen
		}
	}
}

country_event = { #galactic
	id = misc.5
	title = "misc.5.name"
	desc = "misc.5.desc"

	picture = GFX_evt_binary_stars
	show_sound = event_celebration
	location = from
	is_triggered_only = yes

	option = { #aw
		name = "misc.5.a"
		trigger = {
			NOT = {
				has_origin = origin_katzen
			}
		}
	}
	option = { #:KaiserPog:
		name = "misc.5.b"
		trigger = {
			has_origin = origin_katzen
		}
	}
}

country_event = {
	id = misc.6
	title = misc.6.title
	desc = misc.6.desc
	show_sound = par_portrait_02
	picture = GFX_leader_recruitment_bg_renowned
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		has_paragon_dlc = yes
	}

	event_window_type = leader_recruit

	immediate = {
		ethic_leader_creator = {
			SPECIES_CLASS = MAM
			LEADER_PORTRAIT = mam14
			CLASS = general
			NAME = NAME_gunfur
			LEVEL = 4
			GENDER = male
			IMMORTAL = no
			ETHIC = militarist
			DESC = gunfurdesc
			CATCH_PHRASE = gunfur_catch_phrase
		}
		last_created_leader = {
			add_trait = subclass_general_invader
			add_trait = leader_trait_gunfur
			add_trait = katzen_trait_elite
			add_trait = leader_trait_butcher_2
			add_trait = leader_trait_victory_or_death
			set_age = 32
			save_global_event_target_as = gunfur
		}
	}

	picture_event_data = {
		portrait = event_target:ethic_leader
		room = ethic_spaceship_room
	}

	option = {
		name = DISMISS
		tag = dismiss_leader
		hidden_effect = {
			event_target:gunfur = {
				kill_leader = {
					flag = gunfur show_notification = no
				}
			}
		}
	}
	option = {
		name = misc.6.a
		response_text = misc.6.a.response
		is_dialog_only = yes
	}
	option = {
		name = misc.6.b
		response_text = misc.6.b.response
		is_dialog_only = yes
	}
	option = {
		name = misc.6.c
		response_text = misc.6.c.response
		is_dialog_only = yes
	}
	option = {
		name = HIRE
		tag = hire_leader
		custom_tooltip = misc.6.hire_custom_tooltip
		hidden_effect = {
			ethic_leader_hire_effect = {
				GLOBAL_EVENT_TARGET = gunfur
			}
			create_fleet = {
				name = "Großdominiontracks Force"
				effect = {
					set_owner = root
					while = {
						count = 1
						create_army_transport = {
							army_type = dominion_tracks
							army_name = "NAME_dominiontracks"
							ship_name = "NAME_dominiontracks"
						}
						 
					}
					set_location = {
						target = root.capital_scope
					}
				}
			}
			last_created_army = {
				assign_leader = event_target:gunfur
			}
		}
	}
}

country_event = {
	id = misc.7
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROMFROMFROM = { # Planet where ground combat is taking place.
			OR = {
				random_ground_combat_attacker = {
					limit = {
						exists = leader
						leader = {
							has_trait = leader_trait_gunfur
						}
					}
					leader = {
						save_event_target_as = gunfur_loot
					}
				}
				random_ground_combat_defender = {
					limit = {
						exists = leader
						leader = {
							has_trait = leader_trait_gunfur
						}
					}
					leader = {
						save_event_target_as = gunfur_loot
					}
				}
			}
		}

		# If attacking army has a leader with Crusader trait, award Unity.
		if = {
			limit = { exists = event_target:gunfur_loot }
			FROMFROM = {
				if = {
					limit = {
						event_target:gunfur_loot = {
							has_trait = leader_trait_gunfur
						}
					}
					add_resource = {
						alloys = 10
						energy = 25
						minerals = 25
						food = 25
					}
				}
			}
		}
	}
}

country_event = {
	id = misc.9
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_origin = origin_katzen
		has_policy_flag = derega_kaiser
	}

	immediate = {
		ruler = {
			change_species = event_target:kaiser_portrait_hd
			change_leader_portrait = event_target:kaiser_portrait_hd
		}
	}
}

country_event = {
	id = misc.8
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_origin = origin_katzen
		has_policy_flag = pvz_cattail
	}

	immediate = {
		ruler = {
			change_species = event_target:kaiser_portrait_pvz
			change_leader_portrait = event_target:kaiser_portrait_pvz
		}
	}
}

country_event = {
	id = misc.10
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_origin = origin_katzen
		ruler = {
			NOT = {
				has_leader_flag = kaiser_kattail
			}
		}
	}
	immediate = {
		if = {
			limit = { NOT = {
				any_owned_leader = {
					has_leader_flag = kaiser_kattail
				}
			} }
			create_leader = {
				class = admiral
				species = event_target:kaiser_portrait_hd
				name = "Kattail"
				skill = 4
				gender = male
				immortal = yes
				set_age = 189
				traits = {
					trait = leader_trait_ruler_kaiser_cattail
					trait = trait_ruler_charismatic_2
					trait = trait_ruler_military_pioneer
					trait = leader_trait_intimidator
					trait = subclass_admiral_strategist
				}
				effect = {
					set_leader_flag = kaiser_kattail
					save_global_event_target_as = kaiser_kattail
					event_target:katzenartig = {
						ruler = {
							unassign_leader = this
						}
						assign_leader = event_target:kaiser_kattail
					}
				}
			}
		}
		else = {
			if = {
				limit = { ruler = {
					NOT = {
						has_leader_flag = kaiser_kattail
					}
				} }
				ruler = {
					unassign_leader = this
				}
				assign_leader = event_target:kaiser_kattail
			}
		}
	}
}

#Aeternum Insights
country_event = {
	id = misc.11
	is_triggered_only = yes
	title = misc.11.title
	desc = misc.11.desc
	picture = GFX_evt_legendary_leader
	show_sound = event_factions
	event_window_type = leader_story

	picture_event_data = {
		portrait = root.owner.ruler
		room = root.owner
	}

	option = {
		name = misc.11.a
		custom_tooltip = misc.11.a.tt
		hidden_effect = {
			increase_aeternite_intel = yes
			increase_aeternite_intel = yes
			increase_aeternite_intel = yes
		}
	}
}

planet_event = {
	id = misc.12
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				OR = {
					owner = { NOT = { has_origin = origin_katzen } }
					is_colony = no
				}
			}
			if = {
				limit = { is_colony = yes }
				save_event_target_as = destroyed_siegfried_world
				owner = { country_event = { id = misc.13 } }
				destroy_colony = yes
			}
			remove_all_buildings = yes
			remove_all_districts = yes
			change_pc = pc_katzenland
			set_planet_entity = {
				entity = katzenland_01_entity
			}
			add_modifier = {
				modifier = "irradiated_desert_planet"
				days = -1
			}
			while = {
				count = 12
				create_katzenland_deposits = yes
			}
			solar_system = {
				remove_star_flag = siegfried_anti_jump_star
				every_neighbor_system = { remove_star_flag = siegfried_anti_jump_star }
			}
		}
		else = {
			planet_event = { id = misc.12 days = 30 }
		}
	}
}

country_event = {
	id = misc.13
	title = "giga_katzen.121.name"
	desc = "giga_katzen.121.desc"
	is_triggered_only = yes
	picture = GFX_evt_exploding_planet
	show_sound = event_super_explosion
	location = event_target:destroyed_siegfried_world


	option = { #NOOOO
		name = "giga_katzen.121.a"
		custom_tooltip = "giga_katzen.121.a.tooltip"
	}
}

country_event = {
	id = misc.14
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		resource_stockpile_compare = {
			resource = alloys
			value >= 1000
		}
		any_planet_within_border = {
			NOT = {
				has_planet_flag = war_forge
			}
		}
		has_edict = katzen_war_forge_construction
	}
	immediate = {
		random_planet_within_border = {
			limit = {
				NOT = {
					has_planet_flag = war_forge
				}
				is_star = no
				OR = {
					habitable_planet = yes
					is_planet_class = pc_pki_flusion_ecu
					is_planet_class = pc_nuked
				}
				is_artificial = no
				giga_habitable_structure = no
				is_colony = yes
				owner = {
					is_primitive = no
				}
			}
			planet.owner = {
				add_resource = {
					alloys = -1000
				}
			}
			solar_system = {
				spawn_megastructure = {
					type = katzen_war_forge_0
					planet = prev
					owner = space_owner
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = katzen_war_forge_0
						planet = { is_same_value = PREVPREVPREV } 
					}
					upgrade_megastructure_to = katzen_war_forge_1
				}
			}
			set_planet_flag = war_forge
		}
	}
}

country_event = {
	id = misc.15
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_origin = origin_katzen
	}
	immediate = {
		every_megastructure = { #Delete any finished war forges in system with ONLY hostile ships
			limit = {
				is_megastructure_type = katzen_war_forge_1
				solar_system = {
					any_fleet_in_system = { #no hostiles
						controller = {
							OR = {
								is_at_war_with = event_target:katzenartig
								is_hostile = event_target:katzenartig
							}
						}
					}
					NOT = { #No katzens
						any_fleet_in_system = {
							owner = { has_origin = origin_katzen }
						}
					}
					# space_owner = { #Doesn't own it
					# 	NOT = { is_country_type = katzenartig_imperium }
					# }
				}
			}
			remove_megastructure = THIS
			solar_system = {
				save_event_target_as = war_forge_destroyed_system
				every_system_planet = {
					limit = { has_planet_flag = war_forge }
					remove_planet_flag = war_forge
				}
				space_owner = { country_event = { id = misc.16 } }
			}
		}
	}
}

country_event = { #Warforge destroyed
	id = misc.16
	title = "giga_katzen.031.name"
	desc = "giga_katzen.031.desc"
	picture = GFX_evt_large_explosion
	show_sound = event_structural_collapse

	location = from
	is_triggered_only = yes

	option = {
		name = "giga_katzen.031.a"
		add_resource = {
			alloys = 500
			minerals = 500
			engineering_research = 1000
			influence = 25
		}
	}
}

planet_event = {
	id = misc.17
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_fleet_in_orbit = {
			any_owned_ship = { is_ship_size = katzen_submarine }
			owner = { has_origin = origin_katzen }
		}
	}

	immediate = {
		add_modifier = {
			modifier = katzen_submarine_subspace_blockade
			days = 3
		}
	}
}

country_event = {
	id = misc.18
	title = misc.18.title
	desc = misc.18.desc
	show_sound = par_portrait_14
	picture = GFX_leader_recruitment_bg_renowned
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		has_paragon_dlc = yes
	}

	event_window_type = leader_recruit

	immediate = {
		ethic_leader_creator = {
			SPECIES_CLASS = MAM
			LEADER_PORTRAIT = mam14
			CLASS = governor
			NAME = NAME_neumeyer
			LEVEL = 4
			GENDER = male
			IMMORTAL = no
			ETHIC = xenophobe
			DESC = neumeyerdesc
			CATCH_PHRASE = neumeyer_catch_phrase
		}
		last_created_leader = {
			add_trait = subclass_governor_economist
			add_trait = leader_trait_neumeyer
			add_trait = katzen_trait_elite
			add_trait = leader_trait_enlister
			add_trait = leader_trait_embezzler
			set_age = 28
			save_global_event_target_as = neumeyer
		}
	}

	picture_event_data = {
		portrait = event_target:ethic_leader
		room = ethic_spaceship_room
	}

	option = {
		name = DISMISS
		tag = dismiss_leader
		hidden_effect = {
			event_target:neumeyer = {
				kill_leader = {
					flag = neumeyer show_notification = no
				}
			}
		}
	}
	option = {
		name = misc.18.a
		response_text = misc.18.a.response
		is_dialog_only = yes
	}
	option = {
		name = misc.18.b
		response_text = misc.18.b.response
		is_dialog_only = yes
	}
	option = {
		name = misc.18.c
		response_text = misc.18.c.response
		is_dialog_only = yes
	}
	option = {
		name = HIRE
		tag = hire_leader
		custom_tooltip = misc.18.hire_custom_tooltip
		hidden_effect = {
			ethic_leader_hire_effect = {
				GLOBAL_EVENT_TARGET = neumeyer
			}
		}
	}
}